<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-GB" xml:lang="en-GB"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.556">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Assess GTFS</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../docs/_static/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../docs/_static/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../docs/_static/tp_logo_white_background.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Assess GTFS</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../docs/getting_started/index.html"> 
<span class="menu-text">Getting Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../docs/explanation/index.html"> 
<span class="menu-text">Explanation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../docs/how_to/index.html"> 
<span class="menu-text">How-To</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../docs/tutorials/index.html"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../../docs/reference/index.html" aria-current="page"> 
<span class="menu-text">API Reference</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-github">    
        <li>
    <a class="dropdown-item" href="https://github.com/datasciencecampus/assess_gtfs">
 <span class="dropdown-text">Source code</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/datasciencecampus/assess_gtfs/issues">
 <span class="dropdown-text">Open an issue</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../docs/reference/calendar.html"><code>gtfs</code></a></li><li class="breadcrumb-item"><a href="../../docs/reference/validation.html">validation</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/reference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">API reference</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text"><code>gtfs</code></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/reference/calendar.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">calendar</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/reference/cleaners.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">cleaners</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/reference/gtfs_utils.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">gtfs_utils</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/reference/multi_validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">multi_validation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/reference/routes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">routes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/reference/validation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">validation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/reference/validators.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">validators</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text"><code>utils</code></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/reference/defence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">defence</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/reference/io.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">io</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">




<section id="assess_gtfs.validation" class="level1">
<h1>validation</h1>
<p><code>validation</code></p>
<p>Validating GTFS data.</p>
<section id="classes" class="level2">
<h2 class="anchored" data-anchor-id="classes">Classes</h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="#assess_gtfs.validation.GtfsInstance">GtfsInstance</a></td>
<td>Create a feed instance for validation, cleaning &amp; visualisation.</td>
</tr>
</tbody>
</table>
<section id="assess_gtfs.validation.GtfsInstance" class="level3">
<h3 class="anchored" data-anchor-id="assess_gtfs.validation.GtfsInstance">GtfsInstance</h3>
<p><code>validation.GtfsInstance(self, gtfs_pth, units='km', route_lookup_pth=None)</code></p>
<p>Create a feed instance for validation, cleaning &amp; visualisation.</p>
<section id="parameters" class="level4">
<h4 class="anchored" data-anchor-id="parameters">Parameters</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 8%">
<col style="width: 14%">
<col style="width: 72%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>gtfs_pth</code></td>
<td>Union[str, bytes, os.PathLike]</td>
<td>File path to GTFS archive.</td>
<td><em>required</em></td>
</tr>
<tr class="even">
<td><code>units</code></td>
<td>(str, optionl)</td>
<td>Spatial units of the GTFS file, defaults to “km”.</td>
<td><code>'km'</code></td>
</tr>
<tr class="odd">
<td><code>route_lookup_pth</code></td>
<td>Union[str, pathlib.Path]</td>
<td>The path to the route type lookup. If left empty, the default path will be used. When None, route lookup table is read from file saved within this package, defaults to None.</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</section>
<section id="attributes" class="level4">
<h4 class="anchored" data-anchor-id="attributes">Attributes</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 19%">
<col style="width: 24%">
<col style="width: 56%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>feed</td>
<td>gtfs_kit.Feed</td>
<td>A gtfs_kit feed produced using the files at <code>gtfs_pth</code> on init.</td>
</tr>
<tr class="even">
<td>gtfs_path</td>
<td>Union[str, pathlib.Path]</td>
<td>The path to the GTFS archive.</td>
</tr>
<tr class="odd">
<td>file_list</td>
<td>list</td>
<td>Files in the GTFS archive.</td>
</tr>
<tr class="even">
<td>validity_df</td>
<td>pd.DataFrame</td>
<td>Table of GTFS errors, warnings &amp; their descriptions.</td>
</tr>
<tr class="odd">
<td>dated_trip_counts</td>
<td>pd.DataFrame</td>
<td>Dated trip counts by modality.</td>
</tr>
<tr class="even">
<td>daily_trip_summary</td>
<td>pd.DataFrame</td>
<td>Summarised trip results by day of the week and modality.</td>
</tr>
<tr class="odd">
<td>daily_route_summary</td>
<td>pd.DataFrame</td>
<td>Dated route counts by modality.</td>
</tr>
<tr class="even">
<td>route_mode_summary_df</td>
<td>pd.DataFrame</td>
<td>Summarised route counts by day of the week and modality.</td>
</tr>
<tr class="odd">
<td>pre_processed_trips</td>
<td>pd.DataFrame</td>
<td>A table of pre-processed trip data.</td>
</tr>
</tbody>
</table>
</section>
<section id="raises" class="level4">
<h4 class="anchored" data-anchor-id="raises">Raises</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 10%">
<col style="width: 89%">
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>TypeError</td>
<td>1. <code>pth</code> is not either of string or pathlib.Path. 2. <code>units</code> is not of type str.</td>
</tr>
<tr class="even">
<td>FileExistsError</td>
<td><code>pth</code> does not exist on disk.</td>
</tr>
<tr class="odd">
<td>ValueError</td>
<td>1. <code>pth</code> does not have the expected file extension(s). 2. <code>units</code> are not one of: “m”, “km”, “metres”, “meters”, “kilometres”, “kilometers”.</td>
</tr>
</tbody>
</table>
</section>
<section id="methods" class="level4">
<h4 class="anchored" data-anchor-id="methods">Methods</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="#assess_gtfs.validation.GtfsInstance.clean_feed">clean_feed</a></td>
<td>Attempt to clean feed using <code>gtfs_kit</code>.</td>
</tr>
<tr class="even">
<td><a href="#assess_gtfs.validation.GtfsInstance.ensure_populated_calendar">ensure_populated_calendar</a></td>
<td>If calendar is absent, creates one from calendar_dates.</td>
</tr>
<tr class="odd">
<td><a href="#assess_gtfs.validation.GtfsInstance.filter_to_bbox">filter_to_bbox</a></td>
<td>Very shallow wrapper around filter_gfts().</td>
</tr>
<tr class="even">
<td><a href="#assess_gtfs.validation.GtfsInstance.filter_to_date">filter_to_date</a></td>
<td>Very shallow wrapper around filter_gtfs().</td>
</tr>
<tr class="odd">
<td><a href="#assess_gtfs.validation.GtfsInstance.get_gtfs_files">get_gtfs_files</a></td>
<td>Return a list of files present in the GTFS feed.</td>
</tr>
<tr class="even">
<td><a href="#assess_gtfs.validation.GtfsInstance.get_route_modes">get_route_modes</a></td>
<td>Summarise the available routes by their associated <code>route_type</code>.</td>
</tr>
<tr class="odd">
<td><a href="#assess_gtfs.validation.GtfsInstance.html_report">html_report</a></td>
<td>Generate a HTML report describing the GTFS data.</td>
</tr>
<tr class="even">
<td><a href="#assess_gtfs.validation.GtfsInstance.is_valid">is_valid</a></td>
<td>Check a feed is valid with <code>gtfs_kit</code>.</td>
</tr>
<tr class="odd">
<td><a href="#assess_gtfs.validation.GtfsInstance.print_alerts">print_alerts</a></td>
<td>Print validity errors &amp; warning messages in full.</td>
</tr>
<tr class="even">
<td><a href="#assess_gtfs.validation.GtfsInstance.save">save</a></td>
<td>Save the cleaned gtfs feed.</td>
</tr>
<tr class="odd">
<td><a href="#assess_gtfs.validation.GtfsInstance.summarise_routes">summarise_routes</a></td>
<td>Produce a summarised table of route statistics by day of week.</td>
</tr>
<tr class="even">
<td><a href="#assess_gtfs.validation.GtfsInstance.summarise_trips">summarise_trips</a></td>
<td>Produce a summarised table of trip statistics by day of week.</td>
</tr>
<tr class="odd">
<td><a href="#assess_gtfs.validation.GtfsInstance.viz_stops">viz_stops</a></td>
<td>Visualise the stops on a map as points or convex hull. Writes file.</td>
</tr>
</tbody>
</table>
<section id="assess_gtfs.validation.GtfsInstance.clean_feed" class="level5">
<h5 class="anchored" data-anchor-id="assess_gtfs.validation.GtfsInstance.clean_feed">clean_feed</h5>
<p><code>validation.GtfsInstance.clean_feed(validate=False, fast_travel=False)</code></p>
<p>Attempt to clean feed using <code>gtfs_kit</code>.</p>
<section id="parameters-1" class="level6">
<h6 class="anchored" data-anchor-id="parameters-1">Parameters</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 13%">
<col style="width: 7%">
<col style="width: 69%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>validate</code></td>
<td>bool</td>
<td>Whether or not to validate the dataframe before cleaning, by default False.</td>
<td><code>False</code></td>
</tr>
<tr class="even">
<td><code>fast_travel</code></td>
<td>bool</td>
<td>Whether or not to clean warnings related to fast travel, by default False.</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="assess_gtfs.validation.GtfsInstance.ensure_populated_calendar" class="level5">
<h5 class="anchored" data-anchor-id="assess_gtfs.validation.GtfsInstance.ensure_populated_calendar">ensure_populated_calendar</h5>
<p><code>validation.GtfsInstance.ensure_populated_calendar()</code></p>
<p>If calendar is absent, creates one from calendar_dates.</p>
<p>Saves calendar table to feed.calendar. Shallow wrapper around gtfs.calendar.create_calendar_from_dates.</p>
<section id="raises-1" class="level6">
<h6 class="anchored" data-anchor-id="raises-1">Raises</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 24%">
<col style="width: 75%">
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>FileNotFoundError</td>
<td>Calendar and calendar_dates are missing, GTFS is invalid.</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="assess_gtfs.validation.GtfsInstance.filter_to_bbox" class="level5">
<h5 class="anchored" data-anchor-id="assess_gtfs.validation.GtfsInstance.filter_to_bbox">filter_to_bbox</h5>
<p><code>validation.GtfsInstance.filter_to_bbox(bbox, crs='epsg:4326')</code></p>
<p>Very shallow wrapper around filter_gfts().</p>
<p>Filters GTFS to a bbox.</p>
<section id="parameters-2" class="level6">
<h6 class="anchored" data-anchor-id="parameters-2">Parameters</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 4%">
<col style="width: 16%">
<col style="width: 70%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>bbox</code></td>
<td>Union[list, GeoDataFrame]</td>
<td>The bbox to filter the GTFS to. Leave as none if the GTFS does not need to be cropped. Format - [xmin, ymin, xmax, ymax]</td>
<td><em>required</em></td>
</tr>
<tr class="even">
<td><code>crs</code></td>
<td>Union[str, int]</td>
<td>The CRS of the given bbox, by default “epsg:4326”</td>
<td><code>'epsg:4326'</code></td>
</tr>
</tbody>
</table>
</section>
<section id="returns" class="level6">
<h6 class="anchored" data-anchor-id="returns">Returns</h6>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>None</td>
<td></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="assess_gtfs.validation.GtfsInstance.filter_to_date" class="level5">
<h5 class="anchored" data-anchor-id="assess_gtfs.validation.GtfsInstance.filter_to_date">filter_to_date</h5>
<p><code>validation.GtfsInstance.filter_to_date(dates)</code></p>
<p>Very shallow wrapper around filter_gtfs().</p>
<p>Filters GTFS to date(s)</p>
<section id="parameters-3" class="level6">
<h6 class="anchored" data-anchor-id="parameters-3">Parameters</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 11%">
<col style="width: 26%">
<col style="width: 46%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>dates</code></td>
<td>Union[str, list]</td>
<td>The date(s) to filter the GTFS to</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
</section>
<section id="returns-1" class="level6">
<h6 class="anchored" data-anchor-id="returns-1">Returns</h6>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>None</td>
<td></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="assess_gtfs.validation.GtfsInstance.get_gtfs_files" class="level5">
<h5 class="anchored" data-anchor-id="assess_gtfs.validation.GtfsInstance.get_gtfs_files">get_gtfs_files</h5>
<p><code>validation.GtfsInstance.get_gtfs_files()</code></p>
<p>Return a list of files present in the GTFS feed.</p>
<section id="returns-2" class="level6">
<h6 class="anchored" data-anchor-id="returns-2">Returns</h6>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>list</td>
<td>A list of files that present within the GTFS file</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="assess_gtfs.validation.GtfsInstance.get_route_modes" class="level5">
<h5 class="anchored" data-anchor-id="assess_gtfs.validation.GtfsInstance.get_route_modes">get_route_modes</h5>
<p><code>validation.GtfsInstance.get_route_modes()</code></p>
<p>Summarise the available routes by their associated <code>route_type</code>.</p>
<section id="returns-3" class="level6">
<h6 class="anchored" data-anchor-id="returns-3">Returns</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 66%">
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>pd.core.frame.DataFrame</td>
<td>Summary table of route counts by transport mode.</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="assess_gtfs.validation.GtfsInstance.html_report" class="level5">
<h5 class="anchored" data-anchor-id="assess_gtfs.validation.GtfsInstance.html_report">html_report</h5>
<p><code>validation.GtfsInstance.html_report(report_dir='outputs', overwrite=False, summary_type='mean', extended_validation=False, clean_feed=True)</code></p>
<p>Generate a HTML report describing the GTFS data.</p>
<section id="parameters-4" class="level6">
<h6 class="anchored" data-anchor-id="parameters-4">Parameters</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 13%">
<col style="width: 16%">
<col style="width: 62%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>report_dir</code></td>
<td>Union[str, pathlib.Path]</td>
<td>The directory to save the report to, by default “outputs”</td>
<td><code>'outputs'</code></td>
</tr>
<tr class="even">
<td><code>overwrite</code></td>
<td>bool</td>
<td>Whether or not to overwrite the existing report if it already exists in the report_dir, by default False</td>
<td><code>False</code></td>
</tr>
<tr class="odd">
<td><code>summary_type</code></td>
<td>str</td>
<td>The type of summary to show on the summaries on the gtfs report, by default “mean”</td>
<td><code>'mean'</code></td>
</tr>
<tr class="even">
<td><code>extended_validation</code></td>
<td>bool</td>
<td>Whether or not to create extended reports for gtfs validation errors/warnings, by default False</td>
<td><code>False</code></td>
</tr>
<tr class="odd">
<td><code>clean_feed</code></td>
<td>bool</td>
<td>Whether or not to clean the feed before validating, by default True</td>
<td><code>True</code></td>
</tr>
</tbody>
</table>
</section>
<section id="returns-4" class="level6">
<h6 class="anchored" data-anchor-id="returns-4">Returns</h6>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>None</td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="raises-2" class="level6">
<h6 class="anchored" data-anchor-id="raises-2">Raises</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 17%">
<col style="width: 82%">
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ValueError</td>
<td>An error raised if the type of summary passed is invalid</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="assess_gtfs.validation.GtfsInstance.is_valid" class="level5">
<h5 class="anchored" data-anchor-id="assess_gtfs.validation.GtfsInstance.is_valid">is_valid</h5>
<p><code>validation.GtfsInstance.is_valid(far_stops=False)</code></p>
<p>Check a feed is valid with <code>gtfs_kit</code>.</p>
<section id="parameters-5" class="level6">
<h6 class="anchored" data-anchor-id="parameters-5">Parameters</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 8%">
<col style="width: 5%">
<col style="width: 80%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>far_stops</code></td>
<td>bool</td>
<td>Whether or not to perform validation for far stops (both between consecutive stops and over multiple stops), by default False.</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
</section>
<section id="returns-5" class="level6">
<h6 class="anchored" data-anchor-id="returns-5">Returns</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 66%">
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>pd.core.frame.DataFrame</td>
<td>Table of errors, warnings &amp; their descriptions.</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="assess_gtfs.validation.GtfsInstance.print_alerts" class="level5">
<h5 class="anchored" data-anchor-id="assess_gtfs.validation.GtfsInstance.print_alerts">print_alerts</h5>
<p><code>validation.GtfsInstance.print_alerts(alert_type='error')</code></p>
<p>Print validity errors &amp; warning messages in full.</p>
<section id="parameters-6" class="level6">
<h6 class="anchored" data-anchor-id="parameters-6">Parameters</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 12%">
<col style="width: 7%">
<col style="width: 69%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>alert_type</code></td>
<td>str</td>
<td>The alert type to print. Also accepts “warning”. Defaults to “error”.</td>
<td><code>'error'</code></td>
</tr>
</tbody>
</table>
</section>
<section id="returns-6" class="level6">
<h6 class="anchored" data-anchor-id="returns-6">Returns</h6>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>None</td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="raises-3" class="level6">
<h6 class="anchored" data-anchor-id="raises-3">Raises</h6>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>AttributeError</td>
<td>No <code>validity_df()</code> attrubute was found.</td>
</tr>
<tr class="even">
<td>UserWarning</td>
<td>No alerts of the specified <code>alert_type</code> were found.</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="assess_gtfs.validation.GtfsInstance.save" class="level5">
<h5 class="anchored" data-anchor-id="assess_gtfs.validation.GtfsInstance.save">save</h5>
<p><code>validation.GtfsInstance.save(path, overwrite=False)</code></p>
<p>Save the cleaned gtfs feed.</p>
<section id="parameters-7" class="level6">
<h6 class="anchored" data-anchor-id="parameters-7">Parameters</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 10%">
<col style="width: 22%">
<col style="width: 56%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>path</code></td>
<td>Union[str, pathlib.Path]</td>
<td>The path to save the GTFS file to. E.g., outputs/cleaned_gtfs.zip</td>
<td><em>required</em></td>
</tr>
<tr class="even">
<td><code>overwrite</code></td>
<td>bool</td>
<td>Whether or not to overwrite any pre-existing files at the given path</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
</section>
<section id="returns-7" class="level6">
<h6 class="anchored" data-anchor-id="returns-7">Returns</h6>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>None</td>
<td></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="assess_gtfs.validation.GtfsInstance.summarise_routes" class="level5">
<h5 class="anchored" data-anchor-id="assess_gtfs.validation.GtfsInstance.summarise_routes">summarise_routes</h5>
<p><code>validation.GtfsInstance.summarise_routes(summ_ops=[np.min, np.max, np.mean, np.median], return_summary=True)</code></p>
<p>Produce a summarised table of route statistics by day of week.</p>
<p>For route count summaries, function counts route_id only, irrespective of which service_id the routes map to. If the services run on different calendar days, they will be counted separately. In cases where more than one service runs the same route on the same day, these will not be counted as distinct routes.</p>
<section id="parameters-8" class="level6">
<h6 class="anchored" data-anchor-id="parameters-8">Parameters</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 10%">
<col style="width: 4%">
<col style="width: 62%">
<col style="width: 22%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>summ_ops</code></td>
<td>list</td>
<td>A list of operators used to get a summary of a given day, by default [np.min, np.max, np.mean, np.median].</td>
<td><code>[np.min, np.max, np.mean, np.median]</code></td>
</tr>
<tr class="even">
<td><code>return_summary</code></td>
<td>bool</td>
<td>When True, a summary is returned. When False, route data for each date is returned, by default True.</td>
<td><code>True</code></td>
</tr>
</tbody>
</table>
</section>
<section id="returns-8" class="level6">
<h6 class="anchored" data-anchor-id="returns-8">Returns</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 83%">
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>pd.DataFrame</td>
<td>A dataframe containing either summarised results or dated route data.</td>
</tr>
</tbody>
</table>
</section>
<section id="raises-4" class="level6">
<h6 class="anchored" data-anchor-id="raises-4">Raises</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 9%">
<col style="width: 90%">
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>TypeError</td>
<td>1. return_summary is not of type pd.df. 2. summ_ops must be a numpy function or a list. 3. Each item in a summ_ops list must be a function. 4. Each item in a summ_ops list must be a numpy namespace export.</td>
</tr>
<tr class="even">
<td>NotImplementedError</td>
<td>summ_ops is a function not exported from numpy.</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="assess_gtfs.validation.GtfsInstance.summarise_trips" class="level5">
<h5 class="anchored" data-anchor-id="assess_gtfs.validation.GtfsInstance.summarise_trips">summarise_trips</h5>
<p><code>validation.GtfsInstance.summarise_trips(summ_ops=[np.min, np.max, np.mean, np.median], return_summary=True)</code></p>
<p>Produce a summarised table of trip statistics by day of week.</p>
<p>For trip count summaries, function counts distinct trip_id only. These are then summarised into average/median/min/max (default) number of trips per day. Raw data for each date can also be obtained by setting the ‘return_summary’ parameter to False (bool).</p>
<section id="parameters-9" class="level6">
<h6 class="anchored" data-anchor-id="parameters-9">Parameters</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 10%">
<col style="width: 4%">
<col style="width: 62%">
<col style="width: 22%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>summ_ops</code></td>
<td>list</td>
<td>A list of operators used to get a summary of a given day, by default [np.min, np.max, np.mean, np.median].</td>
<td><code>[np.min, np.max, np.mean, np.median]</code></td>
</tr>
<tr class="even">
<td><code>return_summary</code></td>
<td>bool</td>
<td>When True, a summary is returned. When False, trip data for each date is returned, by default True.</td>
<td><code>True</code></td>
</tr>
</tbody>
</table>
</section>
<section id="returns-9" class="level6">
<h6 class="anchored" data-anchor-id="returns-9">Returns</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 83%">
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>pd.DataFrame</td>
<td>A dataframe containing either summarised results or dated trip data.</td>
</tr>
</tbody>
</table>
</section>
<section id="raises-5" class="level6">
<h6 class="anchored" data-anchor-id="raises-5">Raises</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 9%">
<col style="width: 90%">
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>TypeError</td>
<td>1. return_summary is not of type pd.df. 2. summ_ops must be a numpy function or a list. 3. Each item in a summ_ops list must be a function. 4. Each item in a summ_ops list must be a numpy namespace export.</td>
</tr>
<tr class="even">
<td>NotImplementedError</td>
<td>summ_ops is a function not exported from numpy.</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="assess_gtfs.validation.GtfsInstance.viz_stops" class="level5">
<h5 class="anchored" data-anchor-id="assess_gtfs.validation.GtfsInstance.viz_stops">viz_stops</h5>
<p><code>validation.GtfsInstance.viz_stops(out_pth, geoms='point', geom_crs=27700, create_out_parent=False, filtered_only=True)</code></p>
<p>Visualise the stops on a map as points or convex hull. Writes file.</p>
<section id="parameters-10" class="level6">
<h6 class="anchored" data-anchor-id="parameters-10">Parameters</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 9%">
<col style="width: 79%">
<col style="width: 3%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>out_pth</code></td>
<td>Union[str, pathlib.Path]</td>
<td>Path to write the map file html document to, including the file name. Must end with ‘.html’ file extension.</td>
<td><em>required</em></td>
</tr>
<tr class="even">
<td><code>geoms</code></td>
<td>str</td>
<td>Type of map to plot. If <code>geoms=point</code> (the default) uses <code>gtfs_kit</code> to map point locations of available stops. If <code>geoms=hull</code>, calculates the convex hull &amp; its area, defaults to “point”.</td>
<td><code>'point'</code></td>
</tr>
<tr class="odd">
<td><code>geom_crs</code></td>
<td>Union[str, int]</td>
<td>Geometric CRS to use for the calculation of the convex hull area only, defaults to “27700” (OSGB36, British National Grid).</td>
<td><code>27700</code></td>
</tr>
<tr class="even">
<td><code>create_out_parent</code></td>
<td>bool</td>
<td>Should the parent directory of <code>out_pth</code> be created if not found, defaults to False.</td>
<td><code>False</code></td>
</tr>
<tr class="odd">
<td><code>filtered_only</code></td>
<td>bool</td>
<td>When True, only stops referenced within stop_times.txt will be plotted. When False, stops referenced in stops.txt will be plotted. Note that gtfs_kit filtering behaviour removes stops from stop_times.txt but not stops.txt, defaults to True.</td>
<td><code>True</code></td>
</tr>
</tbody>
</table>
</section>
<section id="returns-10" class="level6">
<h6 class="anchored" data-anchor-id="returns-10">Returns</h6>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>None</td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="raises-6" class="level6">
<h6 class="anchored" data-anchor-id="raises-6">Raises</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 8%">
<col style="width: 91%">
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>TypeError</td>
<td>1. <code>out_pth</code> is not either of string or pathlib.PosixPath. 2. <code>geoms</code> is not of type str 3. <code>geom_crs</code> is not of type str or int 4. <code>create_out_parent</code> or <code>filtered_only</code> are not of type bool</td>
</tr>
<tr class="even">
<td>FileNotFoundError</td>
<td>Raised if the parent directory of <code>out_pth</code> could not be found on disk and <code>create_out_parent</code> is False.</td>
</tr>
<tr class="odd">
<td>KeyError</td>
<td>The stops table has no ‘stops_code’ column.</td>
</tr>
<tr class="even">
<td>UserWarning</td>
<td>If the file extension of <code>out_pth</code> is not .html, the extension will be changed to .html.</td>
</tr>
</tbody>
</table>


</section>
</section>
</section>
</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/datasciencecampus\.github\.io\/assess_gtfs\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>These docs are built using <a href="https://quarto.org/">Quarto</a>, <a href="https://machow.github.io/quartodoc/get-started/overview.html">quartodoc</a>, and <a href="https://diataxis.fr/">Diátaxis</a>.</p>
</div>   
    <div class="nav-footer-center">
<p>All content is available under the <a href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/">Open Government Licence V3.0</a>, except where otherwise stated.</p>
</div>
    <div class="nav-footer-right">
<p><a href="https://datasciencecampus.ons.gov.uk/"> <img src="https://datasciencecampus.ons.gov.uk/wp-content/uploads/sites/10/2019/05/DSC.png" alt="Data Science Campus logo" style="height:22px;"> </a></p>
</div>
  </div>
</footer>




</body></html>