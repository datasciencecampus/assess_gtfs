<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-GB" xml:lang="en-GB"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Assess GTFS</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../docs/_static/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../docs/_static/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../docs/_static/tp_logo_white_background.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Assess GTFS</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../docs/getting_started/index.html"> 
<span class="menu-text">Getting Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../docs/explanation/index.html"> 
<span class="menu-text">Explanation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../docs/how_to/index.html"> 
<span class="menu-text">How-To</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../docs/tutorials/index.html"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../../docs/reference/index.html" aria-current="page"> 
<span class="menu-text">API Reference</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-github">    
        <li>
    <a class="dropdown-item" href="https://github.com/datasciencecampus/assess_gtfs">
 <span class="dropdown-text">Source code</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/datasciencecampus/assess_gtfs/issues">
 <span class="dropdown-text">Open an issue</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../docs/reference/calendar.html"><code>gtfs</code></a></li><li class="breadcrumb-item"><a href="../../docs/reference/multi_validation.html">multi_validation</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/reference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">API reference</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text"><code>gtfs</code></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/reference/calendar.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">calendar</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/reference/cleaners.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">cleaners</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/reference/gtfs_utils.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">gtfs_utils</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/reference/multi_validation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">multi_validation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/reference/routes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">routes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/reference/validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">validation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/reference/validators.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">validators</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text"><code>utils</code></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/reference/defence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">defence</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/reference/io.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">io</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">




<section id="assess_gtfs.multi_validation" class="level1">
<h1>multi_validation</h1>
<p><code>multi_validation</code></p>
<p>Validating multiple GTFS at once.</p>
<section id="classes" class="level2">
<h2 class="anchored" data-anchor-id="classes">Classes</h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="#assess_gtfs.multi_validation.MultiGtfsInstance">MultiGtfsInstance</a></td>
<td>Create a feed instance for multiple GTFS files.</td>
</tr>
</tbody>
</table>
<section id="assess_gtfs.multi_validation.MultiGtfsInstance" class="level3">
<h3 class="anchored" data-anchor-id="assess_gtfs.multi_validation.MultiGtfsInstance">MultiGtfsInstance</h3>
<p><code>multi_validation.MultiGtfsInstance(self, path)</code></p>
<p>Create a feed instance for multiple GTFS files.</p>
<p>This allows for multiple GTFS files to be cleaned, validated, summarised, filtered and saved at the same time.</p>
<section id="parameters" class="level4">
<h4 class="anchored" data-anchor-id="parameters">Parameters</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 3%">
<col style="width: 16%">
<col style="width: 73%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>path</code></td>
<td>Union[str, list, pathlib.Path]</td>
<td>A list of paths, a singular path object, or a glob string. See more information on glob strings here: https://docs.python.org/3/library/glob.html</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
</section>
<section id="attributes" class="level4">
<h4 class="anchored" data-anchor-id="attributes">Attributes</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 11%">
<col style="width: 72%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>paths</td>
<td>list</td>
<td>A list of the GTFS paths used to create the MultiGtfsInstance object.</td>
</tr>
<tr class="even">
<td>instances</td>
<td>list</td>
<td>A list of GtfsInstance objects created from self.paths.</td>
</tr>
<tr class="odd">
<td>daily_trip_summary</td>
<td>pd.DataFrame</td>
<td>A combined summary of statistics for trips from all GTFS files in the MultiGtfsInstance.</td>
</tr>
<tr class="even">
<td>daily_route_summary</td>
<td>pd.DataFrame</td>
<td>A combined summary of statistics for routes from all GTFS files in the MultiGtfsInstance.</td>
</tr>
</tbody>
</table>
</section>
<section id="raises" class="level4">
<h4 class="anchored" data-anchor-id="raises">Raises</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 18%">
<col style="width: 81%">
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>TypeError</td>
<td>‘path’ is not of type string or list.</td>
</tr>
<tr class="even">
<td>FileNotFoundError</td>
<td>One (or more) of the paths passed to ‘path’ does not exist.</td>
</tr>
<tr class="odd">
<td>FileNotFoundError</td>
<td>There are no GTFS files found in the passed list of paths, or from the glob string.</td>
</tr>
<tr class="even">
<td>ValueError</td>
<td>Path has no file extension.</td>
</tr>
<tr class="odd">
<td>ValueError</td>
<td>One (or more) of the paths passed are not of the filetype ‘.zip’.</td>
</tr>
</tbody>
</table>
</section>
<section id="returns" class="level4">
<h4 class="anchored" data-anchor-id="returns">Returns</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>None</td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="methods" class="level4">
<h4 class="anchored" data-anchor-id="methods">Methods</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="#assess_gtfs.multi_validation.MultiGtfsInstance.clean_feeds">clean_feeds</a></td>
<td>Clean each of the feeds in the MultiGtfsInstance.</td>
</tr>
<tr class="even">
<td><a href="#assess_gtfs.multi_validation.MultiGtfsInstance.ensure_populated_calendars">ensure_populated_calendars</a></td>
<td>Check if calendar is absent and creates one from calendar_dates.</td>
</tr>
<tr class="odd">
<td><a href="#assess_gtfs.multi_validation.MultiGtfsInstance.filter_to_bbox">filter_to_bbox</a></td>
<td>Filter GTFS to a bbox.</td>
</tr>
<tr class="even">
<td><a href="#assess_gtfs.multi_validation.MultiGtfsInstance.filter_to_date">filter_to_date</a></td>
<td>Filter each GTFS to date(s).</td>
</tr>
<tr class="odd">
<td><a href="#assess_gtfs.multi_validation.MultiGtfsInstance.get_dates">get_dates</a></td>
<td>Get all available dates from calendar.txt (or calendar_dates.txt).</td>
</tr>
<tr class="even">
<td><a href="#assess_gtfs.multi_validation.MultiGtfsInstance.is_valid">is_valid</a></td>
<td>Validate each of the feeds in the MultiGtfsInstance.</td>
</tr>
<tr class="odd">
<td><a href="#assess_gtfs.multi_validation.MultiGtfsInstance.plot_service">plot_service</a></td>
<td>Create a line plot of route or trip counts over time.</td>
</tr>
<tr class="even">
<td><a href="#assess_gtfs.multi_validation.MultiGtfsInstance.save_feeds">save_feeds</a></td>
<td>Save the GtfsInstances to a directory.</td>
</tr>
<tr class="odd">
<td><a href="#assess_gtfs.multi_validation.MultiGtfsInstance.summarise_routes">summarise_routes</a></td>
<td>Summarise the combined GTFS data by route_id.</td>
</tr>
<tr class="even">
<td><a href="#assess_gtfs.multi_validation.MultiGtfsInstance.summarise_trips">summarise_trips</a></td>
<td>Summarise the combined GTFS data by trip_id.</td>
</tr>
<tr class="odd">
<td><a href="#assess_gtfs.multi_validation.MultiGtfsInstance.validate_empty_feeds">validate_empty_feeds</a></td>
<td>Ensure the feeds in MultiGtfsInstance are not empty.</td>
</tr>
<tr class="even">
<td><a href="#assess_gtfs.multi_validation.MultiGtfsInstance.viz_stops">viz_stops</a></td>
<td>Visualise all stops from all of the GTFS files.</td>
</tr>
</tbody>
</table>
<section id="assess_gtfs.multi_validation.MultiGtfsInstance.clean_feeds" class="level5">
<h5 class="anchored" data-anchor-id="assess_gtfs.multi_validation.MultiGtfsInstance.clean_feeds">clean_feeds</h5>
<p><code>multi_validation.MultiGtfsInstance.clean_feeds(clean_kwargs=None)</code></p>
<p>Clean each of the feeds in the MultiGtfsInstance.</p>
<section id="parameters-1" class="level6">
<h6 class="anchored" data-anchor-id="parameters-1">Parameters</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 10%">
<col style="width: 13%">
<col style="width: 68%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>clean_kwargs</code></td>
<td>Union[dict, None]</td>
<td>The kwargs to pass to GtfsInstance.clean_feed() for each Gtfs in the MultiGtfsInstance, by default None</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</section>
<section id="returns-1" class="level6">
<h6 class="anchored" data-anchor-id="returns-1">Returns</h6>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>None</td>
<td></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="assess_gtfs.multi_validation.MultiGtfsInstance.ensure_populated_calendars" class="level5">
<h5 class="anchored" data-anchor-id="assess_gtfs.multi_validation.MultiGtfsInstance.ensure_populated_calendars">ensure_populated_calendars</h5>
<p><code>multi_validation.MultiGtfsInstance.ensure_populated_calendars()</code></p>
<p>Check if calendar is absent and creates one from calendar_dates.</p>
<p>Shallow wrapper around GtfsInstance.ensure_populated_calendar().</p>
<section id="returns-2" class="level6">
<h6 class="anchored" data-anchor-id="returns-2">Returns</h6>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>None</td>
<td></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="assess_gtfs.multi_validation.MultiGtfsInstance.filter_to_bbox" class="level5">
<h5 class="anchored" data-anchor-id="assess_gtfs.multi_validation.MultiGtfsInstance.filter_to_bbox">filter_to_bbox</h5>
<p><code>multi_validation.MultiGtfsInstance.filter_to_bbox(bbox, crs='epsg:4326', delete_empty_feeds=False)</code></p>
<p>Filter GTFS to a bbox.</p>
<section id="parameters-2" class="level6">
<h6 class="anchored" data-anchor-id="parameters-2">Parameters</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 11%">
<col style="width: 15%">
<col style="width: 64%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>bbox</code></td>
<td>Union[list, GeoDataFrame]</td>
<td>The bbox to filter the GTFS to. Leave as none if the GTFS does not need to be cropped. Format - [xmin, ymin, xmax, ymax]</td>
<td><em>required</em></td>
</tr>
<tr class="even">
<td><code>crs</code></td>
<td>Union[str, int]</td>
<td>The CRS of the given bbox, by default “epsg:4326”</td>
<td><code>'epsg:4326'</code></td>
</tr>
<tr class="odd">
<td><code>delete_empty_feeds</code></td>
<td>bool</td>
<td>Whether or not to remove empty feeds, by default False</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
</section>
<section id="returns-3" class="level6">
<h6 class="anchored" data-anchor-id="returns-3">Returns</h6>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>None</td>
<td></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="assess_gtfs.multi_validation.MultiGtfsInstance.filter_to_date" class="level5">
<h5 class="anchored" data-anchor-id="assess_gtfs.multi_validation.MultiGtfsInstance.filter_to_date">filter_to_date</h5>
<p><code>multi_validation.MultiGtfsInstance.filter_to_date(dates, delete_empty_feeds=False)</code></p>
<p>Filter each GTFS to date(s).</p>
<section id="parameters-3" class="level6">
<h6 class="anchored" data-anchor-id="parameters-3">Parameters</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 18%">
<col style="width: 50%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>dates</code></td>
<td>Union[str, list]</td>
<td>The date(s) to filter the GTFS to</td>
<td><em>required</em></td>
</tr>
<tr class="even">
<td><code>delete_empty_feeds</code></td>
<td>bool</td>
<td>Whether or not to remove empty feeds, by default False</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
</section>
<section id="returns-4" class="level6">
<h6 class="anchored" data-anchor-id="returns-4">Returns</h6>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>None</td>
<td></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="assess_gtfs.multi_validation.MultiGtfsInstance.get_dates" class="level5">
<h5 class="anchored" data-anchor-id="assess_gtfs.multi_validation.MultiGtfsInstance.get_dates">get_dates</h5>
<p><code>multi_validation.MultiGtfsInstance.get_dates(return_range=True)</code></p>
<p>Get all available dates from calendar.txt (or calendar_dates.txt).</p>
<section id="parameters-4" class="level6">
<h6 class="anchored" data-anchor-id="parameters-4">Parameters</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 14%">
<col style="width: 7%">
<col style="width: 67%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>return_range</code></td>
<td>bool</td>
<td>Whether to return the raw dates, or the min/max range, by default True</td>
<td><code>True</code></td>
</tr>
</tbody>
</table>
</section>
<section id="returns-5" class="level6">
<h6 class="anchored" data-anchor-id="returns-5">Returns</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 10%">
<col style="width: 90%">
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>list</td>
<td>Either the full set of dates, or the range that the dates span between</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="assess_gtfs.multi_validation.MultiGtfsInstance.is_valid" class="level5">
<h5 class="anchored" data-anchor-id="assess_gtfs.multi_validation.MultiGtfsInstance.is_valid">is_valid</h5>
<p><code>multi_validation.MultiGtfsInstance.is_valid(validation_kwargs=None)</code></p>
<p>Validate each of the feeds in the MultiGtfsInstance.</p>
<section id="parameters-5" class="level6">
<h6 class="anchored" data-anchor-id="parameters-5">Parameters</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 66%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>validation_kwargs</code></td>
<td>Union[dict, None]</td>
<td>The kwargs to pass to GtfsInstance.is_valid() for each Gtfs in the MultiGtfsInstance, by default None</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</section>
<section id="returns-6" class="level6">
<h6 class="anchored" data-anchor-id="returns-6">Returns</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 29%">
<col style="width: 70%">
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>self.validity_df : pd.DataFrame</td>
<td>A dataframe containing the validation messages from all of the GtfsInstances.</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="assess_gtfs.multi_validation.MultiGtfsInstance.plot_service" class="level5">
<h5 class="anchored" data-anchor-id="assess_gtfs.multi_validation.MultiGtfsInstance.plot_service">plot_service</h5>
<p><code>multi_validation.MultiGtfsInstance.plot_service(service_type='routes', route_type=True, width=1000, height=550, title=None, plotly_kwargs=None, rolling_average=None, line_date=None)</code></p>
<p>Create a line plot of route or trip counts over time.</p>
<section id="parameters-6" class="level6">
<h6 class="anchored" data-anchor-id="parameters-6">Parameters</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 86%">
<col style="width: 3%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>service_type</code></td>
<td>str</td>
<td>Whether to plot ‘routes’ or ‘trips’. By default ‘routes’.</td>
<td><code>'routes'</code></td>
</tr>
<tr class="even">
<td><code>route_type</code></td>
<td>bool</td>
<td>Whether or not to draw a line for each modality, by default True</td>
<td><code>True</code></td>
</tr>
<tr class="odd">
<td><code>width</code></td>
<td>int</td>
<td>Plot width, by default 1000</td>
<td><code>1000</code></td>
</tr>
<tr class="even">
<td><code>height</code></td>
<td>int</td>
<td>Plot height, by default 550</td>
<td><code>550</code></td>
</tr>
<tr class="odd">
<td><code>title</code></td>
<td>str</td>
<td>Plot title, by default None</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>plotly_kwargs</code></td>
<td>dict</td>
<td>Kwargs to pass to plotly.express.line, by default None</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>rolling_average</code></td>
<td>Union[int, None]</td>
<td>How many days to calculate the rolling average over. When left as None, rolling average is not used. The rolling average is calculated from the centre, meaning if ra=3, the average will be calculated from the current date, previous date and following date. Missing dates are imputed and treated as having values of 0.</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>line_date</code></td>
<td>Union[str, None]</td>
<td>A date to draw a dashed vertical line on. Date should be in format: YYYY-MM-DD, by default None</td>
<td><code>None</code></td>
</tr>
</tbody>
</table>
</section>
<section id="returns-7" class="level6">
<h6 class="anchored" data-anchor-id="returns-7">Returns</h6>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>go.Figure</td>
<td>The timerseries plot</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="assess_gtfs.multi_validation.MultiGtfsInstance.save_feeds" class="level5">
<h5 class="anchored" data-anchor-id="assess_gtfs.multi_validation.MultiGtfsInstance.save_feeds">save_feeds</h5>
<p><code>multi_validation.MultiGtfsInstance.save_feeds(dir, suffix='_new', file_names=None, overwrite=False)</code></p>
<p>Save the GtfsInstances to a directory.</p>
<section id="parameters-7" class="level6">
<h6 class="anchored" data-anchor-id="parameters-7">Parameters</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 4%">
<col style="width: 9%">
<col style="width: 80%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>dir</code></td>
<td>Union[pathlib.Path, str]</td>
<td>The directory to export the GTFS files into.</td>
<td><em>required</em></td>
</tr>
<tr class="even">
<td><code>suffix</code></td>
<td>str</td>
<td>The suffix to apply to save names. The ‘file_name’ param takes priority here.</td>
<td><code>'_new'</code></td>
</tr>
<tr class="odd">
<td><code>file_names</code></td>
<td>list</td>
<td>A list of save names for the altered GTFS. The list must be the same length as the number of GTFS instances. Takes priority over the ‘suffix’ param. Names will be used in order of the instances (access using self.instances()).</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>overwrite</code></td>
<td>bool</td>
<td>Whether or not to overwrite the pre-existing saves with matching paths.</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
</section>
<section id="returns-8" class="level6">
<h6 class="anchored" data-anchor-id="returns-8">Returns</h6>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>None</td>
<td></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="assess_gtfs.multi_validation.MultiGtfsInstance.summarise_routes" class="level5">
<h5 class="anchored" data-anchor-id="assess_gtfs.multi_validation.MultiGtfsInstance.summarise_routes">summarise_routes</h5>
<p><code>multi_validation.MultiGtfsInstance.summarise_routes(summ_ops=[np.min, np.max, np.mean, np.median], return_summary=True, to_days=False, sort_by_route_type=False)</code></p>
<p>Summarise the combined GTFS data by route_id.</p>
<section id="parameters-8" class="level6">
<h6 class="anchored" data-anchor-id="parameters-8">Parameters</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 2%">
<col style="width: 78%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>summ_ops</code></td>
<td>list</td>
<td>A list of numpy operators to gather a summary on. Accepts operators (e.g., np.min) or strings (“min”), by default [np.min, np.max, np.mean, np.median].</td>
<td><code>[np.min, np.max, np.mean, np.median]</code></td>
</tr>
<tr class="even">
<td><code>return_summary</code></td>
<td>bool</td>
<td>When set to False, full data for each trip on each date will be returned, by default True.</td>
<td><code>True</code></td>
</tr>
<tr class="odd">
<td><code>to_days</code></td>
<td>bool</td>
<td>Whether or not to aggregate to days, or to just return counts for trips/routes for each date. When False, summ_ops becomes useless, and should therefore nothing should be passed when calling this function (so it remains as the default), by default False.</td>
<td><code>False</code></td>
</tr>
<tr class="even">
<td><code>sort_by_route_type</code></td>
<td>bool</td>
<td>Whether or not to sort the resulting dataframe by route_type. This only impacts the resulting df when to_days=True, by default False.</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
</section>
<section id="returns-9" class="level6">
<h6 class="anchored" data-anchor-id="returns-9">Returns</h6>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>pd.DataFrame</td>
<td>A dataframe containing the summary</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="assess_gtfs.multi_validation.MultiGtfsInstance.summarise_trips" class="level5">
<h5 class="anchored" data-anchor-id="assess_gtfs.multi_validation.MultiGtfsInstance.summarise_trips">summarise_trips</h5>
<p><code>multi_validation.MultiGtfsInstance.summarise_trips(summ_ops=[np.min, np.max, np.mean, np.median], return_summary=True, to_days=False, sort_by_route_type=False)</code></p>
<p>Summarise the combined GTFS data by trip_id.</p>
<section id="parameters-9" class="level6">
<h6 class="anchored" data-anchor-id="parameters-9">Parameters</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 2%">
<col style="width: 78%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>summ_ops</code></td>
<td>list</td>
<td>A list of numpy operators to summarise with. Accepts operators (e.g., np.min) or strings (“min”) ,by default [np.min, np.max, np.mean, np.median]</td>
<td><code>[np.min, np.max, np.mean, np.median]</code></td>
</tr>
<tr class="even">
<td><code>return_summary</code></td>
<td>bool</td>
<td>When set to False, full data for each trip on each date will be returned, by default True.</td>
<td><code>True</code></td>
</tr>
<tr class="odd">
<td><code>to_days</code></td>
<td>bool</td>
<td>Whether or not to aggregate to days, or to just return counts for trips/routes for each date. When False, summ_ops becomes useless, and therefore nothing should be passed when calling this function (so it remains as the default), by default False.</td>
<td><code>False</code></td>
</tr>
<tr class="even">
<td><code>sort_by_route_type</code></td>
<td>bool</td>
<td>Whether or not to sort the resulting dataframe by route_type. This only impacts the resulting df when to_days=True, by default False.</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
</section>
<section id="returns-10" class="level6">
<h6 class="anchored" data-anchor-id="returns-10">Returns</h6>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>pd.DataFrame</td>
<td>A dataframe containing the summary</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="assess_gtfs.multi_validation.MultiGtfsInstance.validate_empty_feeds" class="level5">
<h5 class="anchored" data-anchor-id="assess_gtfs.multi_validation.MultiGtfsInstance.validate_empty_feeds">validate_empty_feeds</h5>
<p><code>multi_validation.MultiGtfsInstance.validate_empty_feeds(delete=False)</code></p>
<p>Ensure the feeds in MultiGtfsInstance are not empty.</p>
<section id="parameters-10" class="level6">
<h6 class="anchored" data-anchor-id="parameters-10">Parameters</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 11%">
<col style="width: 8%">
<col style="width: 67%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>delete</code></td>
<td>bool</td>
<td>Whether or not to delete the empty feeds, by default False</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
</section>
<section id="returns-11" class="level6">
<h6 class="anchored" data-anchor-id="returns-11">Returns</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 9%">
<col style="width: 90%">
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>list</td>
<td>A list of feeds that are empty and their index in MultiGtfsInstance.instances</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="assess_gtfs.multi_validation.MultiGtfsInstance.viz_stops" class="level5">
<h5 class="anchored" data-anchor-id="assess_gtfs.multi_validation.MultiGtfsInstance.viz_stops">viz_stops</h5>
<p><code>multi_validation.MultiGtfsInstance.viz_stops(path=None, return_viz=True, filtered_only=True)</code></p>
<p>Visualise all stops from all of the GTFS files.</p>
<section id="parameters-11" class="level6">
<h6 class="anchored" data-anchor-id="parameters-11">Parameters</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 9%">
<col style="width: 15%">
<col style="width: 68%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>path</code></td>
<td>Union[str, pathlib.Path]</td>
<td>The path to save the folium map to, by default None.</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>return_viz</code></td>
<td>bool</td>
<td>Whether or not to return the folium map object, by default True.</td>
<td><code>True</code></td>
</tr>
<tr class="odd">
<td><code>filtered_only</code></td>
<td>bool</td>
<td>Whether to filter the stops that are plotted to only stop_id’s that are present in the stop_times table, by default True.</td>
<td><code>True</code></td>
</tr>
</tbody>
</table>
</section>
<section id="returns-12" class="level6">
<h6 class="anchored" data-anchor-id="returns-12">Returns</h6>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>folium.Map</td>
<td>A folium map with all stops plotted on it.</td>
</tr>
<tr class="even">
<td>None</td>
<td>Returns none if ‘return_viz’ is False.</td>
</tr>
</tbody>
</table>
</section>
<section id="raises-1" class="level6">
<h6 class="anchored" data-anchor-id="raises-1">Raises</h6>
<table class="caption-top table">
<colgroup>
<col style="width: 9%">
<col style="width: 90%">
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ValueError</td>
<td>An error is raised if both <code>path</code> and <code>return_viz</code> parameters are None as the map won’t be saved or returned.</td>
</tr>
</tbody>
</table>


</section>
</section>
</section>
</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/datasciencecampus\.github\.io\/assess_gtfs\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>These docs are built using <a href="https://quarto.org/">Quarto</a>, <a href="https://machow.github.io/quartodoc/get-started/overview.html">quartodoc</a>, and <a href="https://diataxis.fr/">Diátaxis</a>.</p>
</div>   
    <div class="nav-footer-center">
<p>All content is available under the <a href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/">Open Government Licence V3.0</a>, except where otherwise stated.</p>
</div>
    <div class="nav-footer-right">
<p><a href="https://datasciencecampus.ons.gov.uk/"> <img src="https://datasciencecampus.ons.gov.uk/wp-content/uploads/sites/10/2019/05/DSC.png" alt="Data Science Campus logo" style="height:22px;"> </a></p>
</div>
  </div>
</footer>




</body></html>